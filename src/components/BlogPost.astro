---
import { type SortedBlogPost, getBlogEntryBySlugOrId } from '@accessors/astro/blogAccessor';
import FormattedDate from './FormattedDate.astro';
import { Heading, NavigationLink } from "@solidComponents/blocks";
import { getRouteDetails } from "../routes";

type Props = SortedBlogPost['data'] & {
	previousPostSlug: SortedBlogPost['previousPostSlug']
	nextPostSlug: SortedBlogPost['nextPostSlug']
	readingTimeMins: number
};

const {
	title,
	description,
	pubDate,
	updatedDate,
	heroImage,
	readingTimeMins,
	previousPostSlug,
	nextPostSlug
} = Astro.props;

const blogPath = getRouteDetails('blog').link

const nextBlogPostDetails = await getBlogEntryBySlugOrId(nextPostSlug);
const prevBlogPostDetails = await getBlogEntryBySlugOrId(previousPostSlug);
---

<article
	class="
		w-full
		[&>img]:max-h-80
		[&>img]:relative
		flex
		flex-col
		justify-center
		items-center"
>
	<div
		class="inline-flex flex-row flex-nowrap place-items-center w-full
			*:py-2 *:px-6 *:text-center -mt-4 flex-grow-0">
		<NavigationLink href={blogPath} className="m-auto">All Posts</NavigationLink>
	</div>

	{heroImage && <img src={heroImage} alt="" />}
	<div class="py-5 text-center">
		<Heading size='3xl' className='py-2' >{title}</Heading>
		<span>
			<div class="inline">Published on <FormattedDate date={pubDate} /></div>
			{
				updatedDate && (
					<div class="inline">
						&nbsp;|&nbsp; Last updated on <FormattedDate date={updatedDate} />
					</div>
				)
			}
			{
				readingTimeMins && (
					<p class="inline">&nbsp;|&nbsp; Time to Read: {readingTimeMins} min{readingTimeMins >= 2 ? 's' : ''}</p>
				)
			}
		</span>
		<hr />
	</div>

	<div
		class="
			overflow-hidden
			w-full
			prose
			before:[&_blockquote_p:first-of-type]:content-none
			after:[&_blockquote_p:last-of-type]:content-noneprose-blockquote:prose-quoteless
			prose-li:m-0
			prose-ul:my-0.5
			prose-ol:my-0.5
			[&_.expressive-code]:my-6
			[&_.header-anchor-link]:pr-2
			prose-code:font-medium
			prose-code:before:content-none
			prose-code:after:content-none
			prose-code:bg-gray-200
			prose-code:px-1 prose-code:py-[1px] prose-code:rounded-md
			[&>blockquote>p]:my-1.5
			[&>p_img]:my-0
		">

			<slot />

	</div>

	<div
		class="inline-flex flex-row flex-nowrap place-items-center w-full *:pb-4 *:pt-6 *:px-6
			*:text-center -mb-4 justify-between">
		<div>
			{nextPostSlug && (
				<NavigationLink href={`${blogPath}/${nextPostSlug}`}>
					Next {nextBlogPostDetails && (
						<>| {nextBlogPostDetails.data.title}</>
					)}
				</NavigationLink>)}
		</div>
		<div>
			{previousPostSlug && (
				<NavigationLink href={`${blogPath}/${previousPostSlug}`}>
					{prevBlogPostDetails && (
						<>{prevBlogPostDetails.data.title} |</>
					)} Prev
				</NavigationLink>)}
		</div>
	</div>
</article>
